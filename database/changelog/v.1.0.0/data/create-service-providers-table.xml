<databaseChangeLog xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
   http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd">

    <changeSet id="16" author="wladponomar@gmail.com">
        <sql>
            CREATE TABLE IF NOT EXISTS service_providers (
                id BIGSERIAL PRIMARY KEY,
                name TEXT NOT NULL CHECK(256 > LENGTH(name)),
                location TEXT NOT NULL CHECK(1024 > LENGTH(location)),
                type TEXT NOT NULL CHECK(64 > LENGTH(type)),
                status TEXT NOT NULL CHECK(64 > LENGTH(status)),
                created_at TIMESTAMPTZ NOT NULL,
                updated_at TIMESTAMPTZ,
                deleted_at TIMESTAMPTZ
                );

            ALTER TABLE service_providers
                ADD COLUMN IF NOT EXISTS search tsvector
                    GENERATED ALWAYS AS (to_tsvector('russian', replace(service_providers.name, 'ั', 'ะต'))) STORED;
            CREATE INDEX IF NOT EXISTS service_providers_search_index ON service_providers USING GIN (search);
        </sql>
    </changeSet>

</databaseChangeLog>