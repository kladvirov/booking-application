<databaseChangeLog xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
   http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd">

    <changeSet id="4" author="wladponomar@gmail.com">
        <sql>
            CREATE TABLE IF NOT EXISTS users
            (
                id
                BIGSERIAL
                PRIMARY
                KEY,
                first_name
                TEXT
                NOT
                NULL
                CHECK (
                64 >
                LENGTH
            (
                first_name
            )),
                last_name TEXT NOT NULL CHECK
            (
                64 >
                LENGTH
            (
                last_name
            )),
                login TEXT NOT NULL CHECK
            (
                128 >
                LENGTH
            (
                login
            )) UNIQUE,
                password TEXT NOT NULL CHECK
            (
                128 >
                LENGTH
            (
                password
            )),
                email TEXT NOT NULL CHECK
            (
                256 >
                LENGTH
            (
                email
            )),
                status TEXT NOT NULL CHECK
            (
                64 >
                LENGTH
            (
                status
            )),
                balance DECIMAL NOT NULL CHECK
            (
                balance
                >=
                0
            ),
                created_at TIMESTAMPTZ NOT NULL,
                deleted_at TIMESTAMPTZ,
                updated_at TIMESTAMPTZ
                );

            ALTER TABLE users
                ADD COLUMN search tsvector
                    GENERATED ALWAYS AS (to_tsvector('russian', replace(
                            users.first_name || ' ' || users.last_name || ' ' || users.login,
                            'ั', 'ะต'))) STORED;
            CREATE INDEX users_search_index ON users USING GIN (search);
        </sql>
    </changeSet>

</databaseChangeLog>